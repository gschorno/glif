(function(k){var f=k.glif={};f.base={};f.webGLSupport=f.base.webGLSupport=function(a){var b=!0===!!window.WebGLRenderingContext;!b&&a&&a("sorry, your device does not support WebGL! Please go to http://get.webgl.org</a> for more info.");return b};f.getWebGLContext=f.base.getWebGLContext=function(a,b,c){var e=null;"function"===typeof b&&(c=b,b={});b=b||{};c=c||alert;"string"===typeof a&&(a=document.getElementById(a));try{e=a.getContext("webgl",b)||a.getContext("experimental-webgl",b)}catch(d){return console.log("failed to get webgl context, ",
d),c&&c("failed to get webgl context, try again or go to get.webgl.org for more info.\n"+d),null}return e};f.base.createShader=function(a,b,c,e){c=a.createShader(c);a.shaderSource(c,b);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS)){var d=a.getShaderInfoLog(c);a.deleteShader(c);return e&&e("webgl shader compile error:\n"+d+"\nsource: \n"+b)}return c};f.base.createProgram=function(a,b,c,e){var d=a.createProgram(),g;if("string"===typeof b){if((g=128>b.length?document.getElementById(b):
null)&&"x-shader/x-vertex"===g.type)b=g.text;if(!(b=f.base.createShader(a,b,a.VERTEX_SHADER,e)))return}if("string"===typeof c){if((g=128>c.length?document.getElementById(c):null)&&"x-shader/x-fragment"===g.type)c=g.text;if(!(c=f.base.createShader(a,c,a.FRAGMENT_SHADER,e)))return}a.attachShader(d,b);a.attachShader(d,c);a.linkProgram(d);return!a.getProgramParameter(d,a.LINK_STATUS)?(b=a.getProgramInfoLog(d),a.deleteProgram(d),console.log("webgl link error, ",b),e&&e("webgl link error, "+b)):d};f.base.createShaderFromScriptElement=
function(a,b,c){var e=document.getElementById(b);return!e?c&&c("shader script element '"+b+"' not found"):createShader(a,e.text,{"x-shader/x-fragment":a.FRAGMENT_SHADER,"x-shader/x-vertex":a.VERTEX_SHADER}[e.type],c)};window.requestAnimFrame=window.requestAnimFrame||function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}()})(this);
(function(k){var f=k.glif;f.glsl={floatstr:function(a){a=""+parseFloat(a);return-1===a.indexOf(".")?a+".":a},joinLines:function(a,b){b=b||"\n";if(a){if(Array.isArray(a))return a.join(b)+b;if("string"===typeof a)return a+b}return""},filterExpr:function(a){return a.replace(/[^\w\s\.\,\:\?\(\)\*\+\;\-\/\=<\>\|\&]/g,"")},filterFunction:function(a){return a.replace(/[^\w\s\.\,\:\?\(\)\*\+\;\-\/\=<\>\|\&\{\}]/g,"")},commonVS:"attribute vec3 aPos;\nattribute vec2 aTexCoord;\nvarying   vec2 pos;\n",commonFS:"precision mediump float;\nvarying   vec2 pos;\n",
commonUniforms:"uniform   vec2 pixelSize;\n",getDefaultVS:function(a){return this.commonVS+"void main(void) {\n  gl_Position = "+(a?"vec4(aPos.x, -aPos.y, aPos.z, 1.)":"vec4(aPos, 1.)")+";\n  pos = aTexCoord;\n}\n"},getMat3VS:function(){return f.glsl.commonVS+"uniform mat3 transform;\nvoid main() {\n  gl_Position = vec4(transform * aPos, 1);\n  pos = aTexCoord;\n}\n"},getSampleStackShaderText:function(a,b,c){"object"===typeof b&&(c=b,b=c.expr);var c=c||{},e=[],d=[];c.noxy||(d.push("  float x = pos.x;"),
d.push("  float y = pos.y;"));for(var g=0;g<a;g++){var f=c.samplenames?c.samplenames[g]:"sample"+g,j=c.varnames?c.varnames[g]:"c"+g;e.push("uniform sampler2D "+f+";");d.push("  vec4 "+j+" = texture2D("+f+", pos);")}c.uniforms&&c.uniforms.forEach(function(a){e.push("uniform "+a)});return[this.commonFS+this.joinLines(c.globals),this.joinLines(e),this.joinLines(c.functions),"void main() {",this.joinLines(d),this.joinLines(c.locals),"  gl_FragColor = "+this.filterExpr(b)+";","}"].join("\n")},getSampleGLSLText:function(a,
b){return"texture2D("+(b||"sample0")+", pos + pixelSize * vec2("+a[0]+", "+a[1]+"))"},getWeightedSampleSumShaderText:function(a,b,c){for(var c=c||{},e="string"===typeof a,d=c.samplename||"sample0",g=this.commonFS+this.commonUniforms+this.joinLines(c.globals)+"\nuniform sampler2D "+d+";\n"+(e?"uniform float "+a+"["+b.length+"];\n":"")+this.joinLines(c.functions)+"\nvoid main() {\n"+this.joinLines(c.locals)+"vec4 sum = vec4(0.0);\n",f=0;f<b.length;f++)g+="sum += "+this.getSampleGLSLText(b[f],d)+" * "+
(e?a+"["+f+"]":this.floatstr(a[f]))+";\n";g+="gl_FragColor = ";g=c.value_script?g+(value_script+";\n"):c.rgb?g+("vec4(sum.rgb, texture2D("+d+", pos).a);\n"):g+"sum;\n";return g+"}"},helpers:{color:{lum:"float lum(vec3 C) { return 0.3 * C.r + 0.59 * C.g + 0.11 * C.b; }\n",clipColor:"float clipColor(vec3 C) {\n  float L = lum(C);\n  float n = min(C.r, C.g, C.b);\n  float x = max(C.r, C.g, C.b);\n  if(n < 0.0)\n    C = L + (((C - L) * L) / (L - n));\n  if(x > 1.0)\n    C = L + (((C - L) * (1 - L)) / (x - L));\n  return C;\n}\n",
setLum:"float setLum(C, l) {\n  float d = l - lum(C);\n  return clipColor(C + vec3(d));\n}\n",maxC:"float maxC(vec3 C) { return max(max(C.r, C.g), C.b); }\n",minC:"float maxC(vec3 C) { return max(max(C.r, C.g), C.b); }\n",sat:"float sat(vec3 C) {\n  return maxC(C) - minC(C)\n}\n",setSat:"void setSatColor(float Cmin, float Cmid, float Cmax, float s) {\n  if(Cmax > Cmin)\n    Cmid = (((Cmid - Cmin) * s) / (Cmax - Cmin))\n    Cmax = s\n  else\n    Cmid = Cmax = 0\n  Cmin = 0\n}\nfloat setSat(vec3 C, float s) {\n  if (C.r <= C.g) {\n    if (C.g <= C.b) return setSatColor(C.r, C.g, C.b, s);\n    else {\n      if (C.r <= C.b) setSatColor(C.r, C.b, C.g, s);\n      else setSatColor(C.b, C.r, C.g, s);\n    }\n  } else {\n    if (C.r <= C.b) setSatColor(C.g, C.r, C.b, s);\n    else {\n      if (C.g <= C.b) setSatColor(C.g, C.b, C.r, s);\n      else setSatColor(C.b, C.g, C.r, s);\n    }\n  }\n  return C;\n}\n"}}}})(this);
(function(k){var f=k.glif;f.mat3=function(a){function b(a,b){var d=a[0],g=a[1],f=a[2],j=a[3],l=a[4],m=a[5],n=a[6],k=a[7],o=a[8],p=b[0],r=b[1],s=b[2],u=b[3],v=b[4],w=b[5],x=b[6],y=b[7],z=b[8];return[p*d+r*j+s*n,p*g+r*l+s*k,p*f+r*m+s*o,u*d+v*j+w*n,u*g+v*l+w*k,u*f+v*m+w*o,x*d+y*j+z*n,x*g+y*l+z*k,x*f+y*m+z*o]}this.setArray=function(a){for(this._m=a.slice();9>this._m.length;)this._m.push(0);return this};this.identity=function(){return this.setArray([1,0,0,0,1,0,0,0,1])};this.zero=function(){return this.setArray([0,
0,0,0,0,0,0,0,0])};this.setTranslation=function(a,b){return this.setArray([1,0,0,0,1,0,a||0,b||0,1])};this.setScale=function(a,b){return this.setArray([a,0,0,0,isNaN(b)?a:b,0,0,0,1])};this.setRotation=function(a){var b=Math.cos(a),a=Math.sin(a);return this.setArray([b,-a,0,a,b,0,0,0,1])};this.setShear=function(a,b){return this.setArray([1,a,0,b,1,0,0,0,1])};this.translate=function(a,b){return this.multiply((new f.mat3).setTranslation(a,b))};this.scale=function(a,b){return this.multiply((new f.mat3).setScale(a,
b))};this.rotate=function(a){return this.multiply((new f.mat3).setRotation(a))};this.shear=function(a,b){return this.multiply((new f.mat3).setShear(a,b))};this.multiply=function(a){this.setArray(b(this._m,a instanceof f.mat3?a._m:a));return this};Array.isArray(a)?this.setArray(a):a instanceof f.mat3?this.setArray(a._m):this.identity();return this}})(this);
(function(k){var f=k.glif;f.glenv=function(a,b,c){"function"===typeof b&&(c=b,b={});b=b||{};this.onerror=c||function(a){alert(Array.isArray(a)?a.join("\n"):a)};this.gl=a;a instanceof HTMLCanvasElement&&(this.gl=a=f.base.getWebGLContext(a,b,c));this.gl&&(this.draw=function(){a.drawArrays(a.TRIANGLE_STRIP,0,4);a.flush()},this.canvas=function(){return a.canvas},this.initVertexData=function(c){c.use();var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);var d=new Float32Array(b.flipVerticesY?[-1,1,0,
1,1,0,-1,-1,0,1,-1,0]:[-1,-1,0,1,-1,0,-1,1,0,1,1,0]),g=a.getAttribLocation(c.program,"aPos");a.enableVertexAttribArray(g);var f=a.getAttribLocation(c.program,"aTexCoord");a.enableVertexAttribArray(f);var j=new Float32Array(b.flipTextureY?[0,1,1,1,0,0,1,0]:[0,0,1,0,0,1,1,1]),l=d.byteLength;a.bufferData(a.ARRAY_BUFFER,l+j.byteLength,a.STATIC_DRAW);a.bufferSubData(a.ARRAY_BUFFER,0,d);a.bufferSubData(a.ARRAY_BUFFER,l,j);a.vertexAttribPointer(g,3,a.FLOAT,a.FALSE,0,0);a.vertexAttribPointer(f,2,a.FLOAT,
a.FALSE,0,l);d=a.canvas.width;g=a.canvas.height;b.viewport?a.viewport.apply(a,b.viewport):a.viewport(0,0,d,g);c._setUniform("2f","pixelSize",1/d,1/g)},this.createProgram=function(a,b){var b=b||{},c=new f.Program(this,f.glsl.getDefaultVS(b.flip),a,b);return c.program?c:null},this.createImageTexture=function(a,b){return(new f.Texture(this,b)).setImage(a)},this.createTexture=function(a,b,c){return null===a||a instanceof f.Texture?a:f.util.isImage(a)?this.createImageTexture(a,b):new f.Texture(this,a,
b,c)},this.copyCanvas=function(a){a.width=this.gl.canvas.width;a.height=this.gl.canvas.height;a.getContext("2d").drawImage(this.gl.canvas,0,0);return a},this.getCanvas=function(a){return a&&a.direct?this.gl.canvas:this.copyCanvas(document.createElement("canvas"))},this.getTexture=function(a){return this.createImageTexture(this.getCanvas(a))})};f.getEnv=function(a,b,c){a||(a=document.createElement("canvas"),a.width=b.width||512,a.height=b.height||512);"string"===typeof a&&(a=document.getElementById(a));
a=new f.glenv(a,b,c);return!a.gl?((c||alert)("error getting WebGL rendering context from canvas"),null):a};f.Texture=function(a,b,c,e){var d=a.gl,g=e;"object"===typeof b&&(g=b,b=g.width,c=g.height);g=g||{};this.bind=function(){d.bindTexture(d.TEXTURE_2D,this.texture)};this.active=function(a){d.activeTexture(d.TEXTURE0+(a||0))};this.texture=d.createTexture();this.format=g.format||d.RGBA;this.type=g.type||d.UNSIGNED_BYTE;this.width=b;this.height=c;"number"===typeof g.textureUnit&&this.active(g.textureUnit);
this.bind();d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,(g.wrap?d.REPEAT:null)||g.wrapS||d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,(g.wrap?d.REPEAT:null)||g.wrapT||d.CLAMP_TO_EDGE);a=g.minFilter||g.filter||d.NEAREST;"linear"===a?a=d.LINEAR:"nearest"===a?a=d.NEAREST:"mipmap"===a&&(a=d.LINEAR_MIPMAP_NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,a);"mipmap"===a&&d.generateMipmap(d.TEXTURE_2D);a=g.magFilter||g.filter||d.NEAREST;"linear"===a?a=d.LINEAR:"nearest"===a&&
(a=d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,a);b&&c&&d.texImage2D(d.TEXTURE_2D,0,this.format,b,c,0,this.format,this.type,g.pixels?new Uint8Array(pixels):null);this.setImage=function(a){this.width=a.width||a.videoWidth;this.height=a.height||a.videoHeight;"number"===typeof g.textureUnit&&d.activeTexture(d.TEXTURE0+g.textureUnit);this.bind();(!("flipY"in g)||g.flipY)&&d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,!0);d.texImage2D(d.TEXTURE_2D,0,this.format,this.format,this.type,a);return this};
this.setTextureData=function(a,b,c){this.width=b||this.width;this.height=c||this.height;this.format=d.RGBA;this.type=d.UNSIGNED_BYTE;d.bindTexture(d.TEXTURE_2D,this.texture);d.pixelStorei(d.UNPACK_ALIGNMENT,1);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,this.width,this.height,0,d.RGBA,this.type,new Uint8Array(a));return this};this.destroy=function(){this.texture&&(d.deleteTexture(this.texture),this.texture=null);return this};this.use=function(a,b,c){d.activeTexture(d.TEXTURE0+(a||0));d.bindTexture(d.TEXTURE_2D,
this.texture);b&&this.texture&&b._setUniform("1i",c||g.name||"sample"+a,a||0);return this};this._fb=null;this.framebuffer=function(){if(this._fb)return this._fb;this._fb=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,this._fb);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,this.texture,0);return this._fb}};f.Texture.prototype.usenull=function(a,b){a.activeTexture(a.TEXTURE0+(b||0));a.bindTexture(a.TEXTURE_2D,null)};f.DoubleBuffer=function(a,b,c,e){var d=!1,g,h,j=[];this.createOwnedTexture=
function(b){b=a.createTexture(b);j.push(b);return b};b?"number"===typeof b&&"number"===typeof c?(g=b,h=c,c=b=null):f.util.isImage(b)?(g=b.width,h=b.height,b=this.createOwnedTexture(b)):b instanceof f.Texture?(g=b.width,h=b.height):"object"===typeof b&&(e=b,b=null):(g=a.gl.canvas.width,h=a.gl.canvas.height,e=e||c);e=e||{};g=g||e.width||a.gl.canvas.width;h=h||e.height||a.gl.canvas.height;b||(b=a.createTexture(g,h,e),j.push(b));c||(c=a.createTexture(g,h,e),j.push(c));var l=b.framebuffer(),m=c.framebuffer();
this.inputTexture=function(){return d?b:c};this.outputTexture=function(){return d?c:b};this.outputFB=function(){return d?m:l};this.advance=function(){d=1-d;return this.inputTexture()};this.destroy=function(){j.forEach(function(a){a.destroy()});j=[]}};f.Program=function(a,b,c,e){var d,g=a.gl;"function"===typeof e&&(d=e,e={});e=e||{};this.use=function(){g.useProgram(this.program)};this.run=function(b,c,d){this.use();d&&this._setProperties(d);var e;c instanceof HTMLCanvasElement&&(e=c,c=null);c=c||null;
Array.isArray(b)||(b=[b]);for(d=0;d<b.length;d++)b[d]?b[d].use(d,this):f.Texture.prototype.usenull(g,d);c=c&&c.framebuffer?c.framebuffer():c;g.bindFramebuffer(g.FRAMEBUFFER,c);a.draw();e&&a.copyCanvas(e);return!0};var h={};this._getUniformLocation=function(b){if(h[b])return h[b];h[b]=a.gl.getUniformLocation(this.program,b);return h[b]};this._setUniform=function(b,c,d){var e=Array.isArray(d)&&"v"!==b.slice(-1)?d:Array.prototype.slice.call(arguments,2);e.unshift(this._getUniformLocation(c));a.gl["uniform"+
b].apply(a.gl,e)};this._setUniforms=function(a){for(var b=0;b<a.length;b++){var c=a[b];this._setUniform(c[0],c[1],c.slice(2))}};this._setPropertyVector=function(a,b,c){2==b.length?this._setUniform(c?"2i":"2f",a,b[0],b[1]):3==b.length?this._setUniform(c?"3i":"3f",a,b[0],b[1],b[2]):4==b.length?this._setUniform(c?"4i":"4f",a,b[0],b[1],b[2],b[3]):this._setUniform(c?"1iv":"1fv",a,b)};this._setPropertyMatrix3=function(a,b){g.uniformMatrix3fv(this._getUniformLocation(a),!1,b instanceof f.mat3?b._m:b)};this._setProperty=
function(a,b){Array.isArray(b)?this._setPropertyVector(a,b):"object"===typeof b?b instanceof f.mat3?this._setPropertyMatrix3(a,b):"mat3"===b.type?this._setPropertyMatrix3(a,b.value):Array.isArray(b.value)?this._setPropertyVector(a,b.value,"int"===b.type):this._setUniform("int"===b.type?"1i":"1f",a,b.value):"number"===typeof b?this._setUniform("1f",a,b):console.log("unknown type for uniform property",a,b)};this._setProperties=function(a){if(a)for(var b in a)this._setProperty(b,a[b])};this.program=
f.base.createProgram(a.gl,b,c,d||a.onerror);if(!this.program)return null;e.noinit||a.initVertexData(this,e);return this};f.programs=f.programs||{};f.programs.CopyProgram=function(a,b,c){b=b||{};this.mat3=c||[1,0,0,0,1,0,0,0,1];var b=f.glsl.commonFS+"uniform sampler2D sample0;\nvoid main(void) {\n  gl_FragColor = texture2D(sample0, pos);\n"+(b.rgb?"  gl_FragColor.a = "+f.glsl.floatstr(b.alpha||1)+";\n":"")+"}",e=new f.Program(a,f.glsl.getMat3VS(),b);this.run=function(a,b){e.run(a,b,{transform:{type:"mat3",
value:this.mat3}})}}})(this);
(function(k){var f=k.glif;f.functions={};f.functions._applyShader=function(a,b,c,e,d){if(b=a.createProgram(b,d))return a=a.createTexture(c),b.run(a,e)};f.functions.generate=function(a,b,c){var e;"object"===typeof b&&(e=b,b=e.exprtext);e=e||{};b=f.glsl.getSampleStackShaderText(0,b);return this._applyShader(a,b,null,c,e)};f.functions.effect=function(a,b,c,e){if(b instanceof f.glenv)b=b.getCanvas();else if(!b||!f.util.isProgramInput(b))e=c,c=b,b=null;var d;"object"===typeof c&&(d=c,c=d.expr);d=d||{};
b=b||a.getTexture();c=f.glsl.getSampleStackShaderText(1,c,{varnames:["c"]});return this._applyShader(a,c,b,e,d)};f.functions.blendexpr=function(a,b){var c={normal:"__Cs__.rgb",lighten:"max(__Cb__.rgb, __Cs__.rgb)",darken:"min(__Cb__.rgb, __Cs__.rgb)",multiply:"__Cb__.rgb * __Cs__.rgb",screen:"vec3(1.) - (vec3(1.) - __Cb__.rgb) * (vec3(1.) - __Cs__.rgb)",subtract:"__Cb__.rgb - __Cs__.rgb",difference:"abs(__Cb__.rgb - __Cs__.rgb)",overlay:"vec3((__Cb__.r < 0.5) ? (2.*__Cb__.r*__Cs__.r) : (1.-2.*(1.-__Cb__.r)*(1.-__Cs__.r)),\n     (__Cb__.g < 0.5) ? (2.*__Cb__.g*__Cs__.g) : (1.-2.*(1.-__Cb__.g)*(1.-__Cs__.g)),\n     (__Cb__.b < 0.5) ? (2.*__Cb__.b*__Cs__.b) : (1.-2.*(1.-__Cb__.b)*(1.-__Cs__.b)))",
"hard-light":"vec3((__Cs__.r < 0.5) ? (2.*__Cb__.r*__Cs__.r) : (1.-2.*(1.-__Cb__.r)*(1.-__Cs__.r)),\n     (__Cs__.g < 0.5) ? (2.*__Cb__.g*__Cs__.g) : (1.-2.*(1.-__Cb__.g)*(1.-__Cs__.g)),\n     (__Cs__.b < 0.5) ? (2.*__Cb__.b*__Cs__.b) : (1.-2.*(1.-__Cb__.b)*(1.-__Cs__.b)))","color-dodge":"vec3((__Cb__.r == 0.) ? 0. : ((__Cs__.r == 1.) ? 1. : min(1., __Cb__.r / (1. - __Cs__.r))),\n     (__Cb__.g == 0.) ? 0. : ((__Cs__.g == 1.) ? 1. : min(1., __Cb__.g / (1. - __Cs__.g))),\n     (__Cb__.b == 0.) ? 0. : ((__Cs__.b == 1.) ? 1. : min(1., __Cb__.b / (1. - __Cs__.b))))",
"color-burn":"vec3((__Cb__.r == 1.) ? 1. : ((__Cs__.r == 0.) ? 0. : (1. - min(1., (1. - __Cb__.r) / __Cs__.r))),\n     (__Cb__.g == 1.) ? 1. : ((__Cs__.g == 0.) ? 0. : (1. - min(1., (1. - __Cb__.g) / __Cs__.g))),\n     (__Cb__.b == 1.) ? 1. : ((__Cs__.b == 0.) ? 0. : (1. - min(1., (1. - __Cb__.b) / __Cs__.b))))","soft-light":"vec3( (__Cs__.r <= 0.5) ? (__Cb__.r - (1. - clamp(2. * __Cs__.r, 0., 1.)) * __Cb__.r * (1. - __Cb__.r)) : __Cb__.r + (2. * __Cs__.r - 1.) * ((__Cb__.r <= 0.25) ? (((16. * __Cb__.r - 12.) * __Cb__.r + 4.) * __Cb__.r) : sqrt(__Cb__.r) - __Cb__.r),\n      (__Cs__.g <= 0.5) ? (__Cb__.g - (1. - clamp(2. * __Cs__.g, 0., 1.)) * __Cb__.g * (1. - __Cb__.g)) : __Cb__.g + (2. * __Cs__.g - 1.) * ((__Cb__.g <= 0.25) ? (((16. * __Cb__.g - 12.) * __Cb__.g + 4.) * __Cb__.g) : sqrt(__Cb__.g) - __Cb__.g),\n      (__Cs__.b <= 0.5) ? (__Cb__.b - (1. - clamp(2. * __Cs__.b, 0., 1.)) * __Cb__.b * (1. - __Cb__.b)) : __Cb__.b + (2. * __Cs__.b - 1.) * ((__Cb__.b <= 0.25) ? (((16. * __Cb__.b - 12.) * __Cb__.b + 4.) * __Cb__.b) : sqrt(__Cb__.b) - __Cb__.b))",
"pin-light":"vec3((__Cs__.r < 0.5) ? min(__Cb__.r, 2.0 * __Cs__.r) : max(__Cb__.r, 2.0*(__Cs__.r - 0.5)),\n     (__Cs__.g < 0.5) ? min(__Cb__.g, 2.0 * __Cs__.g) : max(__Cb__.g, 2.0*(__Cs__.g - 0.5)),\n     (__Cs__.b < 0.5) ? min(__Cb__.b, 2.0 * __Cs__.b) : max(__Cb__.b, 2.0*(__Cs__.b - 0.5)))",exclusion:"(__Cb__ + __Cs__ - 2. * __Cb__ * __Cs__).rgb"};compositeExprs={over:"vec4(\n(1.0 - Cs.a) * Cb.rgb * Cb.a + (1.0 - Cb.a) * Cs.rgb * Cs.a + Cs.a * Cb.a * (\n__CBlendExpr__\n), (1.0 - Cs.a) * Cb.a + Cs.a)",
"in":"// in composite modes are incorrect currently\nvec4(\nCs.rgb * Cs.a * (1.-Cb.a) + Cb.a * Cs.a * (\n__CBlendExpr__\n), Cs.a * (1. - Cb.a) + Cs.a)",out:"// out composite modes are incorrect currently\nvec4(\nCb.rgb * Cb.a * (1.-Cs.a) + Cb.a * Cs.a * (\n__CBlendExpr__\n), Cb.a * (1. - Cs.a) + Cb.a)"};var e,d=!1;if(!b||"source-over"===b)e=compositeExprs.over;else if("destination-over"===b)e=compositeExprs.over,d=!0;else if("source-in"===b)e=compositeExprs["in"];else if("destination-in"===b)e=compositeExprs["in"],
d=!0;else if("source-out"===b)e=compositeExprs.out;else if("destination-out"===b)e=compositeExprs.out,d=!0;else{if("destination"===b)return"vec4(Cb.rgb * Cb.a, Cb.a)";if("copy"===b)return"vec4(Cs.rgb * Cs.a, Cs.a)"}if(!e)return console.log("blendexpr() composite mode "+b+"not found"),"vec4(\n// unknown/unsupported composite mode "+e+" \n0.5, 0., 1.-x, 1.)";d=c[a].replace(/__Cs__/g,d?"Cb":"Cs").replace(/__Cb__/g,d?"Cs":"Cb");d||(console.log("blendexpr() blend mode "+a+"not found, using normal"),d=
"// blendexpr() blend mode "+a+"not found, using normal\n"+c.normal.replace(/__Cs__/g,"Cs").replace(/__Cb__/g,"Cb"));return e.replace(/__CBlendExpr__/g,"\n// blend expr\n"+d+"\n//\n")};f.functions.blendComposite=function(a,b,c,e,d){e instanceof f.Texture||(d=e||{},e=null);var g;"string"===typeof d?(g=d,d={}):d&&(g=d.expr||blendexpr(d.blendmode,d.compositemode));d.varnames=d.varnames||["Cb","Cs"];g=f.glsl.getSampleStackShaderText(2,g,d);if(g=a.createProgram(g))return b=a.createTexture(b),a=a.createTexture(c),
g.run([b,a],e,d.properties)};f.functions.blendStack=function(a,b,c,e){c instanceof f.Texture||(e=c||{},c=null);var d;"string"===typeof e?(d=e,e={}):e&&(d=e.expr);d=f.glsl.getSampleStackShaderText(b.length,d,e);if(program=a.createProgram(d)){d=[];for(var g=0;g<b.length;g++)d.push(a.createTexture(b[g]));return program.run(d,c,e.properties)}};f.u=f.util={};f.util.isImage=function(a){return a instanceof HTMLCanvasElement||a instanceof HTMLImageElement||a instanceof HTMLVideoElement};f.util.isProgramInput=
function(a){return this.isImage(a)||a instanceof f.Texture};f.glenv.prototype.generate=function(a,b){return f.functions.generate(this,a,b)};f.glenv.prototype.effect=function(a,b,c){return f.functions.effect(this,a,b,c)};f.glenv.prototype.blendComposite=function(a,b,c,e,d){return f.functions.blendComposite(this,a,b,c,e,d)};f.glenv.prototype.blendStack=function(a,b,c){return f.functions.blendStack(this,a,b,c)}})(this);
(function(k){var f=k.glif;f.area={kernelFromCentroid:function(a){for(var b=[],c=1-a.length;c<a.length;c++)b.push(a[0>c?-c:c]);return b},getHorizBlurShaderText:function(a){for(var b=[],c=this.kernelFromCentroid(a),e=1-a.length;e<a.length;e++)b.push([e,0]);return f.glsl.getWeightedSampleSumShaderText(c,b)},getVertBlurShaderText:function(a){for(var b=[],c=this.kernelFromCentroid(a),e=1-a.length;e<a.length;e++)b.push([0,e]);return f.glsl.getWeightedSampleSumShaderText(c,b)},blurs:{_generate_weights:function(a,
b){for(var b=Math.max(1,Math.abs(b||a.radius)),c=[],e=Math.ceil(b),d=this.generators[(a.name||a.type)+"_blur"],f=0;f<e;f++){var h=d(f/b,a);isNaN(h)?c.push(1.001001):c.push(h)}return c},generators:{gaussian_blur:function(a,b){var c=b.sigma||0.5,c=2*c*c;return 1/Math.sqrt(Math.PI*c)*Math.exp(-(a*a/c))},q_gaussian_blur:function(a,b){function c(a){var b=[0.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-0.13857109526572012,9.984369578019572E-6,
1.5056327351493116E-7];if(0.5>a)return Math.PI/(Math.sin(Math.PI*a)*c(1-a));for(var a=a-1,e=b[0],f=0;f<b.length;f++)e+=b[f]/(a+f);t=a+b.length-1.5;return Math.sqrt(2*Math.PI)*Math.pow(t,a+0.5)*Math.exp(-t)*e}var e=b.sigma||0.5;q=b.q||1;e=2*e*e;e=1/((1>q?2*Math.sqrt(Math.PI)*c(1/(1-q))/((3-q)*Math.sqrt(1-q)*c((3-q)/(2*(1-q)))):1===q?Math.PI:Math.sqrt(Math.PI)*c((3-q)/(2*(q-1)))/((3-q)*Math.sqrt(q-1)*c(1/(q-1))))*Math.sqrt(e))*(1===q?1:1/Math.pow(1+(1-q)*-(a*a/e),1/(1-q)));return Math.max(0,1-e)},box_blur:function(){return 1},
triangle_blur:function(a){return 1-a}},_normalizeCentroid:function(a){var b=0;a.forEach(function(a,e){b+=(e?2:1)*a});0>=b&&(b=1);return a.map(function(a){return a/b})},getWeights:function(a,b){return this._normalizeCentroid(this._generate_weights(a,b))}},normalizeSeriesSum:function(a){var b=0;a.forEach(function(a){b+=a});return 0>=b?a:a.map(function(a){return a/b})},runProgramList:function(a,b,c,e){a=new f.DoubleBuffer(a,b);for(b=0;b<e.length;b++){var d=e[b],g=b===e.length-1;d.program.run(a.advance(),
g?c||null:a.outputFB(),d.params)}a.destroy()},applyBlur:function(a,b,c,e){var d=e.icount||1,g=a.createProgram(f.area.getVertBlurShaderText(e.weights)),h=a.createProgram(f.area.getHorizBlurShaderText(e.weights)),j=[];if(e.interleave)for(e=0;e<d;e++)j.push({program:h}),j.push({program:g});else{for(e=0;e<d;e++)j.push({program:h});for(e=0;e<d;e++)j.push({program:g})}this.runProgramList(a,b,c,j)},blur:function(a,b,c,e){if(b instanceof f.glenv)b=b.getCanvas();else if(!b||!f.util.isProgramInput(b))e=c,c=
b,b=null;var b=b||a.getCanvas(),d=1,g=c.radius;if(c.passcount)d=c.passcount,g*=Math.sqrt(d)/d;else for(;c.maxradius&&g>c.maxradius;)d*=2,g*=Math.sqrt(2)/2;var h=f.area.blurs.getWeights(c,g);this.applyBlur(a,b,e,{weights:h,icount:d,interleave:c.interleave});return[h,d,g?g:h.length]},getConvolveShaderText:function(a,b,c,e){e=e||{};if(Array.isArray(a)){for(;a.length<b*c;)a.push(0);e.no_normalize||this.normalizeSeriesSum(a)}for(var d=[],g=0;g<c;g++)for(i=0;i<b;i++)d.push([i-(b-1)/2,g-(c-1)/2]);return f.glsl.getWeightedSampleSumShaderText(a,
d,e)},convolve:function(a,b,c,e,d,g){c=getConvolveShaderText(c,e,d,g);f.functions._applyShader(a,c,b)},warpImageShaderText:f.glsl.commonFS+f.glsl.commonUniforms+"uniform sampler2D imageSrc;\nuniform sampler2D imageWarp;\nuniform mat3 transform;\nuniform float expval;\nvoid main() {\n  vec3 warpvec = (texture2D(imageWarp, pos).rgb - vec3(0.5))*2.;\n  float mag = length(warpvec);\n  warpvec *= pow(mag, expval) / mag;\n  warpvec = (transform * vec3(pixelSize * warpvec.xy, 1.));\n  gl_FragColor = texture2D(imageSrc, pos + warpvec.xy);\n}",
warpImage:function(a,b,c,e,d){var g=e.mat3||(new f.mat3).rotate(e.angle*Math.PI/180).scale(e.scale).shear(e.shearX,e.shearY),h=a.createProgram(this.warpImageShaderText);if(h)return b=a.createTexture(b,{name:"imageSrc",filter:"linear"}),a=a.createTexture(c,{name:"imageWarp"}),h.run([b,a],d,{transform:g,expval:e.shape||1})}};f.glenv.prototype.convolve=function(a,b,c,e,d){return f.area.convolve(this,a,b,c,e,d)};f.glenv.prototype.blur=function(a,b,c){return f.area.blur(this,a,b,c)};f.glenv.prototype.warpImage=
function(a,b,c,e){return f.area.warpImage(this,a,b,c,e)}})(this);
